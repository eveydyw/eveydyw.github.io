document.addEventListener("DOMContentLoaded",function(){console.log("Image Zoom script loaded");let s=1,o=!1,m,h,i=0,a=0,x="ontouchstart"in window,n=[],d=0;const e=document.createElement("div");e.classList.add("image-zoom-overlay","d-none","justify-content-center","align-items-center");const t=document.createElement("div");t.classList.add("image-zoom-container","position-relative","rounded","shadow-lg");const c=document.createElement("img");c.classList.add("image-zoom-img","img-fluid");const f=document.createElement("div");f.classList.add("image-zoom-controls","d-flex","gap-2");function v(e,t,n=""){const s=document.createElement("button"),o=["image-zoom-btn","btn","btn-light","rounded-circle","d-flex","align-items-center","justify-content-center"],i=n?o.concat(n.split(" ").filter(e=>e)):o;return s.classList.add(...i),s.innerHTML=e,s.title=t,s}const y=v("⌂","重置"),p=v("‹","上一张","image-zoom-nav-btn prev"),g=v("›","下一张","image-zoom-nav-btn next"),u=document.createElement("div");u.classList.add("image-zoom-counter"),f.appendChild(y),t.appendChild(c),t.appendChild(f),e.appendChild(t),e.appendChild(p),e.appendChild(g),e.appendChild(u),document.body.appendChild(e);function l(){c.style.transform=`translate(${i}px, ${a}px) scale(${s})`}function r(){s=1,i=0,a=0,l(),t.classList.remove("dragging")}function b(e){r();const t=n[e];console.log("Loading image:",t.src),c.src=t.src,c.alt=t.alt,d=e,u.textContent=`${d+1} / ${n.length}`}function _(){const e=(d+1)%n.length;b(e)}function w(){const e=(d-1+n.length)%n.length;b(e)}function C(){const t=n.length>1;p.style.display=t?"flex":"none",g.style.display=t?"flex":"none",u.style.display=t?"block":"none",e.classList.remove("d-none"),e.classList.add("d-flex"),setTimeout(()=>{e.style.opacity="1"},10),document.body.style.overflow="hidden"}function O(){e.style.opacity="0",setTimeout(()=>{e.classList.remove("d-flex"),e.classList.add("d-none"),r(),document.body.style.overflow=""},300)}const j=document.querySelectorAll("center img");if(n=Array.from(j).map(e=>({src:e.src,alt:e.alt})),console.log("Found images:",j.length),j.forEach(function(e,t){e.classList.add("preview","img-fluid"),e.addEventListener("click",function(){n.length>0&&(b(t),C())})}),y.addEventListener("click",e=>{e.stopPropagation(),r()}),p.addEventListener("click",e=>{e.stopPropagation(),w()}),g.addEventListener("click",e=>{e.stopPropagation(),_()}),x){let e=0,n=1;t.addEventListener("touchstart",t=>{if(t.touches.length===2){const[o,i]=t.touches;e=Math.hypot(i.clientX-o.clientX,i.clientY-o.clientY),n=s}else if(t.touches.length===1&&s>1){o=!0;const e=t.touches[0];m=e.clientX-i,h=e.clientY-a}}),t.addEventListener("touchmove",t=>{if(t.preventDefault(),t.touches.length===2){const[o,i]=t.touches,a=Math.hypot(i.clientX-o.clientX,i.clientY-o.clientY);e>0&&(s=Math.min(Math.max(a/e*n,.5),5),l())}else if(o&&t.touches.length===1){const e=t.touches[0];i=e.clientX-m,a=e.clientY-h,l()}}),t.addEventListener("touchend",()=>{o=!1,e=0})}else t.addEventListener("mousedown",e=>{s>1&&(o=!0,m=e.clientX-i,h=e.clientY-a,t.classList.add("dragging"))}),document.addEventListener("mousemove",e=>{o&&(i=e.clientX-m,a=e.clientY-h,l())}),document.addEventListener("mouseup",()=>{o&&(o=!1,t.classList.remove("dragging"))}),e.addEventListener("wheel",e=>{e.preventDefault();const t=e.deltaY>0?.9:1.1;s=Math.min(Math.max(s*t,.5),5),l()}),t.addEventListener("dblclick",e=>{e.stopPropagation(),r()});e.addEventListener("click",n=>{(n.target===e||n.target===t)&&O()}),document.addEventListener("keydown",t=>{e.style.opacity==="1"&&(t.key==="Escape"?O():t.key==="ArrowRight"?_():t.key==="ArrowLeft"&&w())}),window.addEventListener("resize",()=>{e.classList.contains("d-none")||r()})})